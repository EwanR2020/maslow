<article id="single-need">
  <header>
    <ul class="need-breadcrumb">
      <li><%= link_to "All needs", needs_path %> <span class="divider">/</span></li>
      <li class="active"><%= @need.need_id %>: <%= format_need_goal @need.goal %></li>
    </ul>

    <% if @need.organisations.any? %>
    <p class="organisations"><%= @need.organisations.map(&:name).join(", ") %></p>
    <% end %>

    <h1>
      <div class="row">
        <div class="span8">
          <%= format_need_goal @need.goal %>
        </div>
        <div class="span4 edit-need btn-group">
          <%= link_to edit_need_path(@need), class: 'btn' do %>
            <i class="icon-edit"></i> Edit need
          <% end %>
          <a class="btn" href="#history"><i class="icon-time"></i> See history</a>
        </div>
      </div>
    </h1>
  </header>

  <p class="the-need">
    As a <%= @need.role %><br />
    I need to <%= @need.goal %><br />
    So that <%= @need.benefit %>
  </p>
  <div class="need-wrapper">
    <div class="row">
      <div class="span8">
        <% if @need.met_when.any? %>
          <h3>Need is met when</h3>
          <ul class="met-when">
            <% @need.met_when.each do |criterion| %>
              <li><%= criterion %></li>
            <% end %>
          </ul>

        <% end %>

        <% if @need.justifications.any? %>
          <h3>Need is on GOV.UK because</h3>
          <ul class="justifications">
            <% @need.justifications.each do |justification| %>
              <li><%= justification %></li>
            <% end %>
          </ul>
        <% end %>

        <% if @need.impact.present? %>
          <div class="impact">
            <p>
              <%= format_need_impact @need.impact %>
            </p>
          </div>
        <% end %>
        
        <h3>Related legislation</h3>
        <p>The Health and Social Care Act 2012 (Commencement No. 6) Order 2013</p>
        
        <h3>Further evidence</h3>
        <p>Extra qualitative or quantitative evidence.</p>
        
      </div>

      <% if show_interactions_column?(@need) %>
        <div class="interactions span4">
          <h3>Interactions</h3>

          <% if @need.monthly_need_views.present? %>
            <div class="big-number">
              <%= format_friendly_integer @need.monthly_need_views %>
              <span>Average pageviews a month</span>
            </div>
          <% end %>

          <% if percentage = calculate_percentage(@need.monthly_need_views, @need.monthly_site_views) %>
            <div class="big-number">
              <%= percentage %>
              <span>of site pageviews</span>
            </div>
          <% end %>

          <% if @need.monthly_user_contacts.present? %>
          <div class="big-number">
            <%= format_friendly_integer @need.monthly_user_contacts %>
            <span>Average contacts a month</span>
          </div>
          <% end %>

          <% if @need.monthly_searches.present? %>
            <div class="big-number">
              <%= format_friendly_integer @need.monthly_searches %>
              <span>Average searches a month</span>
            </div>
          <% end %>
        </div>
      <% end %>

    </div>
  </div>
</article>
